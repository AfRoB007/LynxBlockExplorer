<section class="block-explorer-section section bg-bottom">
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<div class="center-heading">
					<h2 class="section-title">Rich List</h2>
				</div>
			</div>
			<div class="offset-lg-3 col-lg-6">
				<div class="center-text">
					<p>Fusce placerat pretium mauris, vel sollicitudin elit lacinia vitae. Quisque sit amet nisi erat.</p>
				</div>					
			</div>
		</div>			
		<div class="row">
			<div class="col-lg-12">
				<div class="table-responsive">
					<table class="table table-striped table-latests">
						<thead>
							<tr>
								<td>Rank</td>
								<td>Address</td>
								<td>Amount</td>
								<td>Percent of coins</td>
								<td>Last Change</td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td colspan="5" class="text-center">Loading ...</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- ***** Contact & Footer Start ***** -->
<footer id="contact">
	<div class="footer-bottom slim">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<p class="copyright">2018 Â© Lynx - Core Development</p>
				</div>
			</div>
		</div>
	</div>
</footer>

<script type="text/javascript">
	$(function(){
		function RichList(){
			this.data = [];
			this.load = function(){
				let _this = this;
				$.ajax({
					url:'/data/richlist',
					type:'GET'		
				}).done(function(result){
					_this.data = result;
					_this.render();
					console.log(_this.data);
					_this.makeProgress();
				});
			}
			this.render = function(){
				let _this = this;
				let items = _this.data.richlist.balance;				
				let table = $('.table-latests tbody');
				let rows = '';
				items.forEach(function(p,index){
					let row = '<tr>';
					row += '<td>'+(index+1)+'</td>';
					row += '<td><a href="/address/'+p.a_id+'">'+p.a_id+'</a></td>';
					row += '<td>'+(p.balance/100000000).toFixed(8)+'</td>';				
					row += '<td>'+_this._getPercentOfCoins(p)+'</td>';
					row += '<td></td>';			
					row +='</tr>';
					rows += row;						
				});
				table.html(rows);				
			}
			this.makeProgress = function(){
				$(".table-latests").find(".table-progress").each(function(i){
					let value = $('.table-progress:eq(' +[i]+ ') .progress-line').data('value');
					$('.table-progress:eq(' +[i]+ ') .progress-line')
					.css("width", parseInt(value, 10) + parseInt(value, 10)  + '%');
				});
			}
			this._getPercentOfCoins = function(p){
				let stats = this.data.stats;
				let percentage = (((p.balance/100000000)/stats.supply) * 100).toFixed(2);
				let html  = '<div class="table-progress">';
					html += '<div class="progress-line" data-value="'+percentage+'"></div>';
					html += '<span>'+percentage+' %</span>';
					html += '</div>';

				return html;
			}
		}
		var details = new RichList();
		details.load();
		setInterval(function () {     
			details.load();         
        },60000);
	});
</script>